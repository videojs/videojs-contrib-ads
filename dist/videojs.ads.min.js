/*! videojs-contrib-ads - v2.1.0 - 2015-06-11
* Copyright (c) 2015 Brightcove; Licensed  */
!function(a,b){"function"==typeof define&&define.amd?define("videojs-contrib-ads",["videojs"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("video.js")):a["videojs-contrib-ads"]=b(videojs)}(this,function(a){!function(b,c,d,e){"use strict";var f=function(a){var b,c,d;for(c=1;c<arguments.length;c++){b=arguments[c];for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},g=function(a,b,c){var d,e,f=Object.prototype.toString.call(b),g=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c);else if(a.on)a.on(b,c);else{if(!a.attachEvent)throw new Error("object has no mechanism for adding event listeners");a.attachEvent("on"+b,c)}};switch(f){case"[object String]":g(a,b,c);break;case"[object Array]":for(d=0,e=b.length;e>d;d++)g(a,b[d],c);break;case"[object Object]":for(d in b)b.hasOwnProperty(d)&&g(a,d,b[d]);break;default:throw new Error("Unrecognized events parameter type: "+f)}return a},h=function(a){return(b.setImmediate||b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.setTimeout)(a,0)},i=function(a){return(b.clearImmediate||b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.clearTimeout)(a)},j=function(a){a.ads.cancelPlayTimeout||(a.ads.cancelPlayTimeout=h(function(){a.ads.cancelPlayTimeout=null,a.paused()||a.pause(),a.one("contentplayback",function(){a.paused()&&a.play()})}))},k=function(a){var b,c,d=a.el().querySelector(".vjs-tech"),e=a.remoteTextTracks?a.remoteTextTracks():[],f=[],g={ended:a.ended(),src:a.currentSrc(),currentTime:a.currentTime(),type:a.currentType()};for(d&&(g.nativePoster=d.poster,g.style=d.getAttribute("style")),c=e.length;c--;)b=e[c],f.push({track:b,mode:b.mode}),b.mode="disabled";return g.suppressedTracks=f,g},l=function(a,b){for(var c=a.className.split(/\s+/),d=c.length,e=[];d--;)c[d]!==b&&e.push(c[d]);a.className=e.join(" ")},m=function(c,d){var f,g,h=c.el().querySelector(".vjs-tech"),i=20,j=d.suppressedTracks,k=function(){for(var a=j.length;a--;)f=j[a],f.track.mode=f.mode},l=function(){var a=!1,e=function(){a=!0};c.currentTime(d.currentTime),d.ended?(b.setTimeout(function(){a||c.play(),c.off("ended",e)},250),c.on("ended",e)):c.play()},m=function(){return h.readyState>1?l():h.seekable===e?l():h.seekable.length>0?l():void(i--?setTimeout(m,50):!function(){try{l()}catch(b){a.log.warn("Failed to resume the content after an advertisement",b)}}())};d.nativePoster&&(h.poster=d.nativePoster),"style"in d&&h.setAttribute("style",d.style||""),g=c.src()?c.src()!==d.src:c.currentSrc()!==d.src,g?(c.one("contentloadedmetadata",k),c.src({src:d.src,type:d.type}),c.load(),c.one("contentcanplay",m)):c.ended()&&d.ended||(k(),c.play())},n=function(a){var b=a.el().querySelector(".vjs-tech");b&&b.removeAttribute("poster")},o={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1},p=function(c){var e,p=this,q=f({},o,c||{});!function(){for(var b=a.Html5.Events,c=b.length,d=function(){return!0},e=function(a,b){b.isImmediatePropagationStopped=d,b.cancelBubble=!0,b.isPropagationStopped=d,p.trigger({type:a+b.type,state:p.ads.state,originalEvent:b})},f=function(a){if("ad-playback"===p.ads.state)e("ad",a);else if("content-playback"===p.ads.state&&"ended"===a.type)e("content",a);else if("content-resuming"===p.ads.state){if(p.ads.snapshot){if(p.currentSrc()!==p.ads.snapshot.src){if("loadstart"===a.type)return;return e("content",a)}if(p.ads.snapshot.ended)return"pause"===a.type||"ended"===a.type?void p.addClass("vjs-has-started"):e("content",a)}"playing"!==a.type&&e("content",a)}};c--;)p.on(b[c],f);return f}(),p.on(["addurationchange","adcanplay"],function(){var a=p.ads.snapshot;p.currentSrc()!==a.src&&p.play()}),p.ads={state:"content-set",startLinearAdMode:function(){p.trigger("adstart")},endLinearAdMode:function(){p.trigger("adend")}},e=function(c){var d={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",j(p),n(p)},adserror:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",j(p)},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){p.el().className+=" vjs-ad-loading",p.ads.timeout=b.setTimeout(function(){p.trigger("adtimeout")},q.prerollTimeout),p.trigger("readyforpreroll")},leave:function(){b.clearTimeout(p.ads.timeout),l(p.el(),"vjs-ad-loading")},events:{play:function(){j(p)},adstart:function(){this.state="ad-playback",p.el().className+=" vjs-ad-playing"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){p.el().className+=" vjs-ad-loading",p.ads.timeout=b.setTimeout(function(){p.trigger("adtimeout")},q.timeout)},leave:function(){b.clearTimeout(p.ads.timeout),l(p.el(),"vjs-ad-loading")},events:{play:function(){j(p)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){this.snapshot=k(p),n(p),p.ads.cancelPlayTimeout&&(i(p.ads.cancelPlayTimeout),p.ads.cancelPlayTimeout=null)},leave:function(){l(p.el(),"vjs-ad-playing"),m(p,this.snapshot),"adend"!==p.ads.triggerevent&&p.trigger("adend")},events:{adend:function(){this.state="content-resuming"},adserror:function(){this.state="content-resuming"}}},"content-resuming":{enter:function(){this.snapshot.ended&&(b.clearTimeout(p.ads._fireEndedTimeout),p.ads._fireEndedTimeout=b.setTimeout(function(){p.trigger("ended")},1e3))},leave:function(){b.clearTimeout(p.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){this.snapshot=k(p),p.el().className+=" vjs-ad-loading",p.ads.timeout=b.setTimeout(function(){p.trigger("adtimeout")},q.postrollTimeout)},leave:function(){b.clearTimeout(p.ads.timeout),l(p.el(),"vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback",p.el().className+=" vjs-ad-playing"},adtimeout:function(){this.state="content-resuming",h(function(){p.trigger("ended")})},adserror:function(){this.state="content-resuming",h(function(){p.trigger("ended")})}}},"content-playback":{enter:function(){p.ads.cancelPlayTimeout&&(i(p.ads.cancelPlayTimeout),p.ads.cancelPlayTimeout=null),p.trigger({type:"contentplayback",triggerevent:p.ads.triggerevent})},events:{adsready:function(){p.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback",p.el().className+=" vjs-ad-playing",n(p)},contentupdate:function(){p.paused()?this.state="content-set":this.state="ads-ready?"},contentended:function(){this.state="postroll?"}}}};!function(b){var e=function(){};((d[b].events||{})[c.type]||e).apply(p.ads),b!==p.ads.state&&(p.ads.triggerevent=c.type,(d[b].leave||e).apply(p.ads),(d[p.ads.state].enter||e).apply(p.ads),q.debug&&a.log("ads",p.ads.triggerevent+" triggered: "+b+" -> "+p.ads.state))}(p.ads.state)},g(p,d.Html5.Events.concat(["adtimeout","contentupdate","contentplaying","contentended","adsready","adserror","adscanceled","adstart","adend"]),e),p.ads.contentSrc=p.currentSrc(),function(){var a=function(){var a;"ad-playback"!==p.ads.state&&(a=p.currentSrc(),a!==p.ads.contentSrc&&(p.trigger({type:"contentupdate",oldValue:p.ads.contentSrc,newValue:a}),p.ads.contentSrc=a))};p.on(["loadstart"],a),h(a)}(),p.paused()||e({type:"play"})};d.plugin("ads",p)}(window,document,a)});